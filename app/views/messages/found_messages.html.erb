<h1>You Found These!</h1>


<div class="container">
  <div class="row">
    <div class="col-4">
      <% @close_messages.each do |close_message| %>
        <% if Geocoder::Calculations.distance_between(["#{@user.latitude}".to_f,"#{@user.longitude}".to_f], ["#{close_message.latitude}".to_f,"#{close_message.longitude}".to_f]) == 0 || Geocoder::Calculations.distance_between(["#{@user.latitude}".to_f,"#{@user.longitude}".to_f], ["#{close_message.latitude}".to_f,"#{close_message.longitude}".to_f]) < 0.01 %>
          <div id="close-message" class= "close-message"data-latitude="<%= close_message.latitude %>" data-longitude="<%= close_message.longitude %>" data-content="<%= close_message.content %>" data-close= "<%= close_message.id %>" data-kept="<%= close_message.kept_message.message_id%>">
            <ul>
              <% if current_user.kept_messages.where(message_id: close_message.id).count == 0 %>
                <li>
                  <p><%= close_message.content %></p>
                  <p><%= close_message.latitude %></p>
                  <p><%= close_message.longitude %></p>
                  <div id="keep-button">
                    <%=form_tag("/kept_messages", method: :post) do%>
                      <input type="hidden" name="user_id" id="user-id" value="<%= current_user.id %>">
                      <input type="hidden" name="message_id" id="message-id" value="<%= close_message.id %>">
                      <input type="submit" value="Keep it?">
                    <% end %>
                  </div>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="col-8">
      <div id="map" class="rounded"></div>
    </div>
  </div>
</div>

           
<script type="text/javascript">
  $(document).ready(function() {
    var mymap = L.map('map').setView([<%= current_user.latitude %>, <%= current_user.longitude %>], 18);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}@2x.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.streets',
        accessToken: "<%= ENV['MAPBOX_ACCESS_TOKEN'] %>"
    }).addTo(mymap);

    var circle = L.circle([<%= current_user.latitude %>, <%= current_user.longitude %>], {
    color: 'green',
    fillColor: '#99ffcc',
    fillOpacity: 0.5,
    radius: 50
}).addTo(mymap);

    var closeMessages = $('.close-message');
    closeMessages.on("click", function(event) {
      var closeLatitude = $(this).data('latitude');
      var closeLongitude = $(this).data('longitude');
      mymap.setView([closeLatitude, closeLongitude], 18);
    });


    // for (var i = 0; i < closeMessages.length; i++ ) {
    //   var latitude = $(closeMessages[i]).data('latitude');
    //   var longitude = $(closeMessages[i]).data('longitude');
    //   var content = $(closeMessages[i]).data('content');
    //   var closeMarker = L.marker([latitude, longitude]).addTo(mymap);
    // //     if ($(this).data('id') === 
    // //       console.log(true);
    // //       };
    // //     else {
    // //       console.log(false);
    // //       }


    // //   closeMarker.bindPopup(content);
    // // }

  });

</script>



        
        
      
      
    



